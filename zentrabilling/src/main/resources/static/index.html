<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zentra - Inventory Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-900 text-white">
    <!-- Sidebar -->
    <div class="flex">
        <div id="sidebar" class="w-64 bg-gray-800 min-h-screen p-4">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-blue-400">Zentra</h1>
                <p class="text-gray-400 text-sm">Inventory Management</p>
            </div>
            
            <nav class="space-y-2">
                <a href="#" onclick="showSection('overview')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="analytics-outline"></ion-icon>
                    <span>Overview</span>
                </a>
                <a href="#" onclick="showSection('billing')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="receipt-outline"></ion-icon>
                    <span>Billing</span>
                </a>
                <a href="#" onclick="showSection('customers')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="people-outline"></ion-icon>
                    <span>Customers</span>
                </a>
                <a href="#" onclick="showSection('inventory')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="cube-outline"></ion-icon>
                    <span>Inventory</span>
                </a>
                <a href="#" onclick="showSection('suppliers')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="business-outline"></ion-icon>
                    <span>Suppliers</span>
                </a>
                <a href="#" onclick="showSection('expenses')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="card-outline"></ion-icon>
                    <span>Expenses</span>
                </a>
                <a href="#" onclick="showSection('settings')" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition-colors">
                    <ion-icon name="settings-outline"></ion-icon>
                    <span>Settings</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Overview Section -->
            <div id="overview" class="section">
                <h2 class="text-3xl font-bold mb-6">Dashboard Overview</h2>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Today's Revenue</p>
                                <p id="todayRevenue" class="text-2xl font-bold text-green-400">₹0</p>
                            </div>
                            <ion-icon name="trending-up-outline" class="text-green-400 text-2xl"></ion-icon>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Monthly Revenue</p>
                                <p id="monthlyRevenue" class="text-2xl font-bold text-blue-400">₹0</p>
                            </div>
                            <ion-icon name="calendar-outline" class="text-blue-400 text-2xl"></ion-icon>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Today's Profit</p>
                                <p id="todayProfit" class="text-2xl font-bold text-purple-400">₹0</p>
                            </div>
                            <ion-icon name="cash-outline" class="text-purple-400 text-2xl"></ion-icon>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Low Stock Items</p>
                                <p id="lowStockCount" class="text-2xl font-bold text-red-400">0</p>
                            </div>
                            <ion-icon name="warning-outline" class="text-red-400 text-2xl"></ion-icon>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4">Low Stock Alerts</h3>
                    <div id="lowStockTable" class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Product</th>
                                    <th class="pb-2">Current Stock</th>
                                    <th class="pb-2">Threshold</th>
                                    <th class="pb-2">Status</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockTableBody">
                                <!-- Low stock items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Billing Section -->
            <div id="billing" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Billing</h2>
                    <div class="space-x-2">
                        <button onclick="showCustomerModal()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">+ Add Customer</button>
                        <button onclick="showProductModal()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg">+ Add Product</button>
                        <button onclick="showInvoiceModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Create Invoice</button>
                    </div>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4">Recent Invoices</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Invoice #</th>
                                    <th class="pb-2">Date</th>
                                    <th class="pb-2">Customer</th>
                                    <th class="pb-2">Total</th>
                                    <th class="pb-2">Status</th>
                                    <th class="pb-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoicesTable">
                                <!-- Invoices will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Customers Section -->
            <div id="customers" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Customers</h2>
                    <button onclick="showCustomerModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Add Customer</button>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Name</th>
                                    <th class="pb-2">Phone</th>
                                    <th class="pb-2">Email</th>
                                    <th class="pb-2">Address</th>
                                    <th class="pb-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable">
                                <!-- Customers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Inventory Section -->
            <div id="inventory" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Inventory</h2>
                    <button onclick="showProductModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Add Product</button>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Name</th>
                                    <th class="pb-2">Category</th>
                                    <th class="pb-2">Barcode</th>
                                    <th class="pb-2">Buying Price</th>
                                    <th class="pb-2">Selling Price</th>
                                    <th class="pb-2">Stock</th>
                                    <th class="pb-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsTable">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Suppliers Section -->
            <div id="suppliers" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Suppliers</h2>
                    <button onclick="showSupplierModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Add Supplier</button>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Name</th>
                                    <th class="pb-2">Phone</th>
                                    <th class="pb-2">Email</th>
                                    <th class="pb-2">Total Products</th>
                                    <th class="pb-2">Total Profit</th>
                                    <th class="pb-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suppliersTable">
                                <!-- Suppliers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Expenses Section -->
            <div id="expenses" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Expenses</h2>
                    <button onclick="showExpenseModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Add Expense</button>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="pb-2">Description</th>
                                    <th class="pb-2">Category</th>
                                    <th class="pb-2">Amount</th>
                                    <th class="pb-2">Date</th>
                                    <th class="pb-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTable">
                                <!-- Expenses will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section hidden">
                <h2 class="text-3xl font-bold mb-6">Settings</h2>
                
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4">Business Information</h3>
                    <form id="settingsForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Business Name</label>
                                <input type="text" id="businessName" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">GSTIN</label>
                                <input type="text" id="gstin" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Phone</label>
                                <input type="text" id="businessPhone" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="businessEmail" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Address</label>
                                <textarea id="businessAddress" rows="3" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Default Tax Rate (%)</label>
                                <input type="number" id="defaultTaxRate" step="0.01" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                            </div>
                        </div>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Add/Edit Product</h3>
            <form id="productForm" class="space-y-4">
                <input type="hidden" id="productId">
                <div>
                    <label class="block text-sm font-medium mb-2">Product Name</label>
                    <input type="text" id="productName" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Category</label>
                    <input type="text" id="productCategory" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Barcode</label>
                    <input type="text" id="productBarcode" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Buying Price</label>
                        <input type="number" id="productCostPrice" step="0.01" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Selling Price</label>
                        <input type="number" id="productSellingPrice" step="0.01" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Stock Quantity</label>
                    <input type="number" id="productStock" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Save</button>
                    <button type="button" onclick="hideProductModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Add/Edit Customer</h3>
            <form id="customerForm" class="space-y-4">
                <input type="hidden" id="customerId">
                <div>
                    <label class="block text-sm font-medium mb-2">Customer Name</label>
                    <input type="text" id="customerName" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Phone</label>
                    <input type="text" id="customerPhone" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="customerEmail" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Address</label>
                    <textarea id="customerAddress" rows="3" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500"></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Save</button>
                    <button type="button" onclick="hideCustomerModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl max-h-screen overflow-y-auto">
            <h3 class="text-xl font-semibold mb-4">Create Invoice</h3>
            <form id="invoiceForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Customer</label>
                        <div class="flex space-x-2">
                            <select id="invoiceCustomer" class="flex-1 p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                                <option value="">Walk-in Customer</option>
                            </select>
                            <button type="button" onclick="quickAddCustomer()" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg text-sm">+ Add</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Tax Rate (%)</label>
                        <input type="number" id="invoiceTaxRate" value="18" step="0.01" oninput="calculateTotals()" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                    </div>
                </div>

                <!-- Invoice Items -->
                <div>
                    <h4 class="text-lg font-semibold mb-2">Items</h4>
                    <div id="invoiceItems" class="space-y-2">
                        <div class="invoice-item grid grid-cols-12 gap-2 items-end">
                            <div class="col-span-5">
                                <label class="block text-sm font-medium mb-1">Product</label>
                                <div class="relative">
                                    <input type="text" class="product-search w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" placeholder="Search product name or barcode..." oninput="searchProduct(this)" autocomplete="off">
                                    <div class="search-results absolute top-full left-0 right-0 bg-gray-700 border border-gray-600 rounded-b max-h-40 overflow-y-auto z-10 hidden"></div>
                                </div>
                                <input type="hidden" class="product-id">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium mb-1">Quantity</label>
                                <input type="number" class="item-quantity w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" value="1" min="1" oninput="calculateItemTotal(this)">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium mb-1">Unit Price</label>
                                <input type="number" class="item-price w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" step="0.01" readonly>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium mb-1">Total</label>
                                <input type="number" class="item-total w-full p-2 bg-gray-700 rounded border border-gray-600" step="0.01" readonly>
                            </div>
                            <div class="col-span-1">
                                <button type="button" onclick="removeInvoiceItem(this)" class="bg-red-600 hover:bg-red-700 p-2 rounded text-sm">×</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" onclick="addInvoiceItem()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg mt-2">+ Add Item</button>
                </div>

                <!-- Totals -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Subtotal</label>
                            <input type="number" id="invoiceSubtotal" step="0.01" value="0.00" readonly class="w-full p-3 bg-gray-600 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Tax Amount</label>
                            <input type="number" id="invoiceTaxAmount" step="0.01" value="0.00" readonly class="w-full p-3 bg-gray-600 rounded-lg">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-2">Grand Total</label>
                            <input type="number" id="invoiceGrandTotal" step="0.01" value="0.00" readonly class="w-full p-3 bg-gray-600 rounded-lg text-xl font-bold">
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg">Create Invoice</button>
                    <button type="button" onclick="hideInvoiceModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplierModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Add/Edit Supplier</h3>
            <form id="supplierForm" class="space-y-4">
                <input type="hidden" id="supplierId">
                <div>
                    <label class="block text-sm font-medium mb-2">Supplier Name</label>
                    <input type="text" id="supplierName" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Phone</label>
                    <input type="text" id="supplierPhone" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="supplierEmail" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Address</label>
                    <textarea id="supplierAddress" rows="3" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500"></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Save</button>
                    <button type="button" onclick="hideSupplierModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Add/Edit Expense</h3>
            <form id="expenseForm" class="space-y-4">
                <input type="hidden" id="expenseId">
                <div>
                    <label class="block text-sm font-medium mb-2">Description</label>
                    <input type="text" id="expenseDescription" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Category</label>
                    <select id="expenseCategory" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                        <option value="">Select Category</option>
                        <option value="Office Supplies">Office Supplies</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Travel">Travel</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Amount</label>
                    <input type="number" id="expenseAmount" step="0.01" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Date</label>
                    <input type="date" id="expenseDate" required class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500">
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Save</button>
                    <button type="button" onclick="hideExpenseModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Invoice Modal -->
    <div id="viewInvoiceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Invoice Details</h3>
                <button onclick="hideViewInvoiceModal()" class="text-gray-400 hover:text-white">
                    <ion-icon name="close-outline" class="text-2xl"></ion-icon>
                </button>
            </div>
            <div id="invoiceDetails">
                <!-- Invoice details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let products = [];
        let customers = [];
        let suppliers = [];
        let currentEditId = null;

        // API Base URL
        const API_BASE = 'http://localhost:8080/api';

        // Utility function for API calls
        async function apiCall(endpoint, method = 'GET', data = null) {
            const config = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                },
            };
            
            if (data) {
                config.body = JSON.stringify(data);
            }
            
            const response = await fetch(`${API_BASE}${endpoint}`, config);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return response.json();
        }

        // Section navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Load data for the section
            switch(sectionName) {
                case 'overview':
                    loadDashboard();
                    break;
                case 'billing':
                    loadInvoices();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'inventory':
                    loadProducts();
                    break;
                case 'suppliers':
                    loadSuppliers();
                    break;
                case 'expenses':
                    loadExpenses();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const stats = await apiCall('/dashboard/stats');
                document.getElementById('todayRevenue').textContent = `₹${stats.todayRevenue || 0}`;
                document.getElementById('monthlyRevenue').textContent = `₹${stats.monthlyRevenue || 0}`;
                document.getElementById('todayProfit').textContent = `₹${stats.todayProfit || 0}`;
                document.getElementById('lowStockCount').textContent = stats.lowStockCount || 0;
                
                const lowStockProducts = await apiCall('/products/low-stock');
                loadLowStockTable(lowStockProducts);
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function loadLowStockTable(products) {
            const tbody = document.getElementById('lowStockTableBody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2">${product.name}</td>
                    <td class="py-2">${product.stock}</td>
                    <td class="py-2">${product.lowStockThreshold}</td>
                    <td class="py-2"><span class="bg-red-600 px-2 py-1 rounded text-xs">Low Stock</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Product functions
        async function loadProducts() {
            try {
                products = await apiCall('/products');
                const tbody = document.getElementById('productsTable');
                tbody.innerHTML = '';
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    const stockClass = product.stock <= product.lowStockThreshold ? 'text-red-400' : 'text-green-400';
                    row.innerHTML = `
                        <td class="py-2">${product.name}</td>
                        <td class="py-2">${product.category || '-'}</td>
                        <td class="py-2">${product.barcode || '-'}</td>
                        <td class="py-2">₹${product.costPrice || 0}</td>
                        <td class="py-2">₹${product.sellingPrice || 0}</td>
                        <td class="py-2 ${stockClass}">${product.stock}</td>
                        <td class="py-2">
                            <button onclick="editProduct(${product.id})" class="bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-xs mr-1">Edit</button>
                            <button onclick="deleteProduct(${product.id})" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function showProductModal(productId = null) {
            currentEditId = productId;
            const modal = document.getElementById('productModal');
            const form = document.getElementById('productForm');
            
            if (productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('productId').value = product.id;
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productCategory').value = product.category || '';
                    document.getElementById('productBarcode').value = product.barcode || '';
                    document.getElementById('productCostPrice').value = product.costPrice || '';
                    document.getElementById('productSellingPrice').value = product.sellingPrice || '';
                    document.getElementById('productStock').value = product.stock;
                }
            } else {
                form.reset();
                document.getElementById('productId').value = '';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideProductModal() {
            document.getElementById('productModal').classList.add('hidden');
            document.getElementById('productModal').classList.remove('flex');
        }

        async function saveProduct(event) {
            event.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                barcode: document.getElementById('productBarcode').value,
                costPrice: parseFloat(document.getElementById('productCostPrice').value),
                sellingPrice: parseFloat(document.getElementById('productSellingPrice').value),
                price: parseFloat(document.getElementById('productSellingPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                stockQuantity: parseInt(document.getElementById('productStock').value)
            };
            
            try {
                if (currentEditId) {
                    await apiCall(`/products/${currentEditId}`, 'PUT', productData);
                } else {
                    await apiCall('/products', 'POST', productData);
                }
                
                hideProductModal();
                loadProducts();
                if (document.getElementById('overview').classList.contains('hidden') === false) {
                    loadDashboard();
                }
            } catch (error) {
                console.error('Error saving product:', error);
                alert('Error saving product');
            }
        }

        function editProduct(id) {
            showProductModal(id);
        }

        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    await fetch(`${API_BASE}/products/${id}`, { method: 'DELETE' });
                    loadProducts();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product');
                }
            }
        }

        // Customer functions
        async function loadCustomers() {
            try {
                customers = await apiCall('/customers');
                const tbody = document.getElementById('customersTable');
                tbody.innerHTML = '';
                
                customers.forEach(customer => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2">${customer.name}</td>
                        <td class="py-2">${customer.phone || '-'}</td>
                        <td class="py-2">${customer.email || '-'}</td>
                        <td class="py-2">${customer.address || '-'}</td>
                        <td class="py-2">
                            <button onclick="editCustomer(${customer.id})" class="bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-xs mr-1">Edit</button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Update customer dropdown in invoice modal
                updateCustomerDropdown();
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        function showCustomerModal(customerId = null) {
            currentEditId = customerId;
            const modal = document.getElementById('customerModal');
            const form = document.getElementById('customerForm');
            
            if (customerId) {
                const customer = customers.find(c => c.id === customerId);
                if (customer) {
                    document.getElementById('customerId').value = customer.id;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerPhone').value = customer.phone || '';
                    document.getElementById('customerEmail').value = customer.email || '';
                    document.getElementById('customerAddress').value = customer.address || '';
                }
            } else {
                form.reset();
                document.getElementById('customerId').value = '';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideCustomerModal() {
            document.getElementById('customerModal').classList.add('hidden');
            document.getElementById('customerModal').classList.remove('flex');
        }

        async function saveCustomer(event) {
            event.preventDefault();
            
            const customerData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                address: document.getElementById('customerAddress').value
            };
            
            try {
                if (currentEditId) {
                    await apiCall(`/customers/${currentEditId}`, 'PUT', customerData);
                } else {
                    await apiCall('/customers', 'POST', customerData);
                }
                
                hideCustomerModal();
                loadCustomers();
            } catch (error) {
                console.error('Error saving customer:', error);
                alert('Error saving customer');
            }
        }

        function editCustomer(id) {
            showCustomerModal(id);
        }

        async function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                try {
                    await fetch(`${API_BASE}/customers/${id}`, { method: 'DELETE' });
                    loadCustomers();
                } catch (error) {
                    console.error('Error deleting customer:', error);
                    alert('Error deleting customer');
                }
            }
        }

        function updateCustomerDropdown() {
            const select = document.getElementById('invoiceCustomer');
            select.innerHTML = '<option value="">Walk-in Customer</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} - ${customer.phone || 'No phone'}`;
                select.appendChild(option);
            });
        }

        // Invoice functions
        async function loadInvoices() {
            try {
                const invoices = await apiCall('/invoices');
                const tbody = document.getElementById('invoicesTable');
                tbody.innerHTML = '';
                
                if (Array.isArray(invoices)) {
                    invoices.forEach(invoice => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="py-2">${invoice.invoiceNumber || 'N/A'}</td>
                            <td class="py-2">${invoice.invoiceDate || 'N/A'}</td>
                            <td class="py-2">Walk-in Customer</td>
                            <td class="py-2">₹${invoice.grandTotal || 0}</td>
                            <td class="py-2">
                                <span class="${invoice.paymentStatus === 'PAID' ? 'bg-green-600' : 'bg-red-600'} px-2 py-1 rounded text-xs">
                                    ${invoice.paymentStatus || 'UNPAID'}
                                </span>
                            </td>
                            <td class="py-2">
                                <button onclick="viewInvoice(${invoice.id})" class="bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-xs mr-1">View</button>
                                <button onclick="togglePaymentStatus(${invoice.id}, '${invoice.paymentStatus}')" class="${invoice.paymentStatus === 'PAID' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-green-600 hover:bg-green-700'} px-2 py-1 rounded text-xs mr-1">
                                    ${invoice.paymentStatus === 'PAID' ? 'Mark Unpaid' : 'Mark Paid'}
                                </button>
                                <button onclick="downloadInvoicePDF(${invoice.id})" class="bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded text-xs">PDF</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" class="py-4 text-center">No invoices found</td></tr>';
                }
            } catch (error) {
                console.error('Error loading invoices:', error);
                const tbody = document.getElementById('invoicesTable');
                tbody.innerHTML = '<tr><td colspan="6" class="py-4 text-center">Error loading invoices</td></tr>';
            }
        }

        function showInvoiceModal() {
            const modal = document.getElementById('invoiceModal');
            const form = document.getElementById('invoiceForm');
            form.reset();
            
            // Reset invoice items
            const itemsContainer = document.getElementById('invoiceItems');
            itemsContainer.innerHTML = `
                <div class="invoice-item grid grid-cols-12 gap-2 items-end">
                    <div class="col-span-5">
                        <label class="block text-sm font-medium mb-1">Product</label>
                        <div class="relative">
                            <input type="text" class="product-search w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" placeholder="Search product name or barcode..." oninput="searchProduct(this)" autocomplete="off">
                            <div class="search-results absolute top-full left-0 right-0 bg-gray-700 border border-gray-600 rounded-b max-h-40 overflow-y-auto z-10 hidden"></div>
                        </div>
                        <input type="hidden" class="product-id">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium mb-1">Quantity</label>
                        <input type="number" class="item-quantity w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" value="1" min="1" oninput="calculateItemTotal(this)">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium mb-1">Unit Price</label>
                        <input type="number" class="item-price w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" step="0.01" readonly>
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium mb-1">Total</label>
                        <input type="number" class="item-total w-full p-2 bg-gray-700 rounded border border-gray-600" step="0.01" readonly>
                    </div>
                    <div class="col-span-1">
                        <button type="button" onclick="removeInvoiceItem(this)" class="bg-red-600 hover:bg-red-700 p-2 rounded text-sm">×</button>
                    </div>
                </div>
            `;
            
            // Reset totals
            document.getElementById('invoiceSubtotal').value = '0.00';
            document.getElementById('invoiceTaxAmount').value = '0.00';
            document.getElementById('invoiceGrandTotal').value = '0.00';
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Load products and customers
            loadProducts();
            loadCustomers();
        }

        function hideInvoiceModal() {
            document.getElementById('invoiceModal').classList.add('hidden');
            document.getElementById('invoiceModal').classList.remove('flex');
        }

        async function searchProduct(input) {
            const query = input.value.trim();
            const resultsDiv = input.nextElementSibling;
            
            if (query.length < 2) {
                resultsDiv.classList.add('hidden');
                return;
            }
            
            try {
                const searchResults = await apiCall(`/products/search?q=${encodeURIComponent(query)}`);
                resultsDiv.innerHTML = '';
                
                if (searchResults.length > 0) {
                    searchResults.slice(0, 5).forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'p-2 hover:bg-gray-600 cursor-pointer border-b border-gray-600';
                        div.innerHTML = `${product.name} - ₹${product.sellingPrice || product.price} - Stock: ${product.stock}`;
                        div.onclick = () => selectProduct(input, product);
                        resultsDiv.appendChild(div);
                    });
                    resultsDiv.classList.remove('hidden');
                } else {
                    resultsDiv.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error searching products:', error);
                resultsDiv.classList.add('hidden');
            }
        }

        function selectProduct(input, product) {
            const item = input.closest('.invoice-item');
            input.value = product.name;
            item.querySelector('.product-id').value = product.id;
            item.querySelector('.item-price').value = product.sellingPrice || product.price;
            input.nextElementSibling.classList.add('hidden');
            calculateItemTotal(item.querySelector('.item-quantity'));
        }

        function calculateItemTotal(quantityInput) {
            const item = quantityInput.closest('.invoice-item');
            const quantity = parseFloat(quantityInput.value) || 0;
            const price = parseFloat(item.querySelector('.item-price').value) || 0;
            const total = quantity * price;
            
            item.querySelector('.item-total').value = total.toFixed(2);
            calculateTotals();
        }

        function calculateTotals() {
            const items = document.querySelectorAll('.invoice-item');
            let subtotal = 0;
            
            items.forEach(item => {
                const total = parseFloat(item.querySelector('.item-total').value) || 0;
                subtotal += total;
            });
            
            const taxRate = parseFloat(document.getElementById('invoiceTaxRate').value) || 0;
            const taxAmount = (subtotal * taxRate) / 100;
            const grandTotal = subtotal + taxAmount;
            
            document.getElementById('invoiceSubtotal').value = subtotal.toFixed(2);
            document.getElementById('invoiceTaxAmount').value = taxAmount.toFixed(2);
            document.getElementById('invoiceGrandTotal').value = grandTotal.toFixed(2);
        }

        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            const newItem = document.createElement('div');
            newItem.className = 'invoice-item grid grid-cols-12 gap-2 items-end';
            newItem.innerHTML = `
                <div class="col-span-5">
                    <label class="block text-sm font-medium mb-1">Product</label>
                    <div class="relative">
                        <input type="text" class="product-search w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" placeholder="Search product name or barcode..." oninput="searchProduct(this)" autocomplete="off">
                        <div class="search-results absolute top-full left-0 right-0 bg-gray-700 border border-gray-600 rounded-b max-h-40 overflow-y-auto z-10 hidden"></div>
                    </div>
                    <input type="hidden" class="product-id">
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Quantity</label>
                    <input type="number" class="item-quantity w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" value="1" min="1" oninput="calculateItemTotal(this)">
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Unit Price</label>
                    <input type="number" class="item-price w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500" step="0.01" readonly>
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium mb-1">Total</label>
                    <input type="number" class="item-total w-full p-2 bg-gray-700 rounded border border-gray-600" step="0.01" readonly>
                </div>
                <div class="col-span-1">
                    <button type="button" onclick="removeInvoiceItem(this)" class="bg-red-600 hover:bg-red-700 p-2 rounded text-sm">×</button>
                </div>
            `;
            container.appendChild(newItem);
        }

        function removeInvoiceItem(button) {
            const item = button.closest('.invoice-item');
            const container = document.getElementById('invoiceItems');
            
            if (container.children.length > 1) {
                item.remove();
                calculateTotals();
            }
        }

        async function saveInvoice(event) {
            event.preventDefault();
            
            const subtotal = parseFloat(document.getElementById('invoiceSubtotal').value);
            const taxRate = parseFloat(document.getElementById('invoiceTaxRate').value);
            const taxAmount = parseFloat(document.getElementById('invoiceTaxAmount').value);
            const grandTotal = parseFloat(document.getElementById('invoiceGrandTotal').value);
            
            if (subtotal <= 0) {
                alert('Please add at least one product to the invoice');
                return;
            }
            
            const invoiceData = {
                customerId: document.getElementById('invoiceCustomer').value || null,
                subtotal: subtotal,
                taxRate: taxRate,
                taxAmount: taxAmount,
                total: subtotal,
                grandTotal: grandTotal
            };
            
            try {
                const invoice = await apiCall('/invoices', 'POST', invoiceData);
                hideInvoiceModal();
                loadInvoices();
                alert('Invoice created successfully!');
            } catch (error) {
                console.error('Error creating invoice:', error);
                alert('Error creating invoice');
            }
        }

        function quickAddCustomer() {
            const name = prompt('Enter customer name:');
            const phone = prompt('Enter customer phone:');
            
            if (name) {
                const customerData = { name, phone: phone || '' };
                
                apiCall('/customers', 'POST', customerData)
                    .then(customer => {
                        customers.push(customer);
                        updateCustomerDropdown();
                        document.getElementById('invoiceCustomer').value = customer.id;
                    })
                    .catch(error => {
                        console.error('Error adding customer:', error);
                        alert('Error adding customer');
                    });
            }
        }

        async function viewInvoice(id) {
            try {
                const invoice = await apiCall(`/invoices/${id}`);
                const modal = document.getElementById('viewInvoiceModal');
                const details = document.getElementById('invoiceDetails');
                
                details.innerHTML = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold">Invoice Number</h4>
                                <p>${invoice.invoiceNumber}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold">Date</h4>
                                <p>${invoice.invoiceDate}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold">Customer</h4>
                                <p>Walk-in Customer</p>
                            </div>
                            <div>
                                <h4 class="font-semibold">Payment Status</h4>
                                <p class="${invoice.paymentStatus === 'PAID' ? 'text-green-400' : 'text-red-400'}">${invoice.paymentStatus || 'UNPAID'}</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 p-4 rounded">
                            <h4 class="font-semibold mb-2">Financial Summary</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>Subtotal: ₹${invoice.subtotal || 0}</div>
                                <div>Tax: ₹${invoice.taxAmount || 0}</div>
                                <div class="col-span-2 font-bold">Grand Total: ₹${invoice.grandTotal || 0}</div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="togglePaymentStatus(${id}, '${invoice.paymentStatus}')" class="${invoice.paymentStatus === 'PAID' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-green-600 hover:bg-green-700'} px-4 py-2 rounded">
                                ${invoice.paymentStatus === 'PAID' ? 'Mark as Unpaid' : 'Mark as Paid'}
                            </button>
                            <button onclick="downloadInvoicePDF(${id})" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">Download PDF</button>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            } catch (error) {
                console.error('Error loading invoice:', error);
                alert('Error loading invoice details');
            }
        }

        function hideViewInvoiceModal() {
            document.getElementById('viewInvoiceModal').classList.add('hidden');
            document.getElementById('viewInvoiceModal').classList.remove('flex');
        }

        async function downloadInvoicePDF(id) {
            try {
                const invoice = await apiCall(`/invoices/${id}`);
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.text('INVOICE', 20, 20);
                
                doc.setFontSize(12);
                doc.text(`Invoice #: ${invoice.invoiceNumber}`, 20, 35);
                doc.text(`Date: ${invoice.invoiceDate}`, 20, 45);
                doc.text(`Customer: Walk-in Customer`, 20, 55);
                
                // Totals
                doc.text(`Subtotal: ₹${invoice.subtotal || 0}`, 20, 80);
                doc.text(`Tax: ₹${invoice.taxAmount || 0}`, 20, 90);
                doc.setFontSize(14);
                doc.text(`Grand Total: ₹${invoice.grandTotal || 0}`, 20, 105);
                
                doc.save(`invoice-${invoice.invoiceNumber}.pdf`);
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF');
            }
        }

        // Supplier functions
        async function loadSuppliers() {
            try {
                suppliers = await apiCall('/suppliers');
                const tbody = document.getElementById('suppliersTable');
                tbody.innerHTML = '';
                
                for (const supplier of suppliers) {
                    try {
                        const analytics = await apiCall(`/suppliers/${supplier.id}/analytics`);
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="py-2">${supplier.name}</td>
                            <td class="py-2">${supplier.phone || '-'}</td>
                            <td class="py-2">${supplier.email || '-'}</td>
                            <td class="py-2">${analytics.totalProducts || 0}</td>
                            <td class="py-2">₹0</td>
                            <td class="py-2">
                                <button onclick="editSupplier(${supplier.id})" class="bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-xs mr-1">Edit</button>
                                <button onclick="deleteSupplier(${supplier.id})" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    } catch (error) {
                        console.error(`Error loading analytics for supplier ${supplier.id}:`, error);
                    }
                }
            } catch (error) {
                console.error('Error loading suppliers:', error);
            }
        }

        function showSupplierModal(supplierId = null) {
            currentEditId = supplierId;
            const modal = document.getElementById('supplierModal');
            const form = document.getElementById('supplierForm');
            
            if (supplierId) {
                const supplier = suppliers.find(s => s.id === supplierId);
                if (supplier) {
                    document.getElementById('supplierId').value = supplier.id;
                    document.getElementById('supplierName').value = supplier.name;
                    document.getElementById('supplierPhone').value = supplier.phone || '';
                    document.getElementById('supplierEmail').value = supplier.email || '';
                    document.getElementById('supplierAddress').value = supplier.address || '';
                }
            } else {
                form.reset();
                document.getElementById('supplierId').value = '';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideSupplierModal() {
            document.getElementById('supplierModal').classList.add('hidden');
            document.getElementById('supplierModal').classList.remove('flex');
        }

        async function saveSupplier(event) {
            event.preventDefault();
            
            const supplierData = {
                name: document.getElementById('supplierName').value,
                phone: document.getElementById('supplierPhone').value,
                email: document.getElementById('supplierEmail').value,
                address: document.getElementById('supplierAddress').value
            };
            
            try {
                if (currentEditId) {
                    await apiCall(`/suppliers/${currentEditId}`, 'PUT', supplierData);
                } else {
                    await apiCall('/suppliers', 'POST', supplierData);
                }
                
                hideSupplierModal();
                loadSuppliers();
            } catch (error) {
                console.error('Error saving supplier:', error);
                alert('Error saving supplier');
            }
        }

        function editSupplier(id) {
            showSupplierModal(id);
        }

        async function deleteSupplier(id) {
            if (confirm('Are you sure you want to delete this supplier?')) {
                try {
                    await fetch(`${API_BASE}/suppliers/${id}`, { method: 'DELETE' });
                    loadSuppliers();
                } catch (error) {
                    console.error('Error deleting supplier:', error);
                    alert('Error deleting supplier');
                }
            }
        }

        // Expense functions
        async function loadExpenses() {
            try {
                const expenses = await apiCall('/expenses');
                const tbody = document.getElementById('expensesTable');
                tbody.innerHTML = '';
                
                expenses.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2">${expense.description}</td>
                        <td class="py-2">${expense.category}</td>
                        <td class="py-2">₹${expense.amount}</td>
                        <td class="py-2">${expense.expenseDate}</td>
                        <td class="py-2">
                            <button onclick="editExpense(${expense.id})" class="bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-xs mr-1">Edit</button>
                            <button onclick="deleteExpense(${expense.id})" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading expenses:', error);
            }
        }

        function showExpenseModal(expenseId = null) {
            currentEditId = expenseId;
            const modal = document.getElementById('expenseModal');
            const form = document.getElementById('expenseForm');
            
            if (expenseId) {
                // Load expense data for editing
                apiCall(`/expenses/${expenseId}`)
                    .then(expense => {
                        document.getElementById('expenseId').value = expense.id;
                        document.getElementById('expenseDescription').value = expense.description;
                        document.getElementById('expenseCategory').value = expense.category;
                        document.getElementById('expenseAmount').value = expense.amount;
                        document.getElementById('expenseDate').value = expense.expenseDate;
                    })
                    .catch(error => console.error('Error loading expense:', error));
            } else {
                form.reset();
                document.getElementById('expenseId').value = '';
                document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideExpenseModal() {
            document.getElementById('expenseModal').classList.add('hidden');
            document.getElementById('expenseModal').classList.remove('flex');
        }

        async function saveExpense(event) {
            event.preventDefault();
            
            const expenseData = {
                description: document.getElementById('expenseDescription').value,
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                expenseDate: document.getElementById('expenseDate').value
            };
            
            try {
                if (currentEditId) {
                    await apiCall(`/expenses/${currentEditId}`, 'PUT', expenseData);
                } else {
                    await apiCall('/expenses', 'POST', expenseData);
                }
                
                hideExpenseModal();
                loadExpenses();
                if (document.getElementById('overview').classList.contains('hidden') === false) {
                    loadDashboard();
                }
            } catch (error) {
                console.error('Error saving expense:', error);
                alert('Error saving expense');
            }
        }

        function editExpense(id) {
            showExpenseModal(id);
        }

        async function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                try {
                    await fetch(`${API_BASE}/expenses/${id}`, { method: 'DELETE' });
                    loadExpenses();
                    if (document.getElementById('overview').classList.contains('hidden') === false) {
                        loadDashboard();
                    }
                } catch (error) {
                    console.error('Error deleting expense:', error);
                    alert('Error deleting expense');
                }
            }
        }

        // Settings functions
        async function loadSettings() {
            try {
                const settings = await apiCall('/settings');
                if (settings.length > 0) {
                    const setting = settings[0];
                    document.getElementById('businessName').value = setting.businessName || '';
                    document.getElementById('gstin').value = setting.gstin || '';
                    document.getElementById('businessPhone').value = setting.phone || '';
                    document.getElementById('businessEmail').value = setting.email || '';
                    document.getElementById('businessAddress').value = setting.address || '';
                    document.getElementById('defaultTaxRate').value = setting.defaultTaxRate || 18;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function saveSettings(event) {
            event.preventDefault();
            
            const settingsData = {
                businessName: document.getElementById('businessName').value,
                gstin: document.getElementById('gstin').value,
                phone: document.getElementById('businessPhone').value,
                email: document.getElementById('businessEmail').value,
                address: document.getElementById('businessAddress').value,
                defaultTaxRate: parseFloat(document.getElementById('defaultTaxRate').value)
            };
            
            try {
                const settings = await apiCall('/settings');
                if (settings.length > 0) {
                    await apiCall(`/settings/${settings[0].id}`, 'PUT', settingsData);
                } else {
                    await apiCall('/settings', 'POST', settingsData);
                }
                
                alert('Settings saved successfully!');
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Error saving settings');
            }
        }

        // Event listeners
        document.getElementById('productForm').addEventListener('submit', saveProduct);
        document.getElementById('customerForm').addEventListener('submit', saveCustomer);
        document.getElementById('invoiceForm').addEventListener('submit', saveInvoice);
        document.getElementById('supplierForm').addEventListener('submit', saveSupplier);
        document.getElementById('expenseForm').addEventListener('submit', saveExpense);
        document.getElementById('settingsForm').addEventListener('submit', saveSettings);

        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.relative')) {
                document.querySelectorAll('.search-results').forEach(div => {
                    div.classList.add('hidden');
                });
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            showSection('overview');
        });
    </script>
</body>
</html>